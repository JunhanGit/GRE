<!doctype html><html lang="zh-CN">
<head>
  <base href="./">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>GRE 词汇训练器</title>

  <!-- PWA / iOS -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#4A7BFF">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./apple-touch-icon.png">

  <style>
  :root{
    --bg:  hsl(220 30% 98%);
    --ink: hsl(215 32% 18%);
    --muted: hsl(215 12% 48%);
    --glass: rgba(255,255,255,.55);
    --glass-b: rgba(255,255,255,.8);
    --border: rgba(30,40,60,.10);
    --accent: hsl(222 80% 66%);
    --accent-weak: hsl(222 85% 75%);
    --success: hsl(156 62% 45%);
    --warn: hsl(29 88% 55%);
    --danger: hsl(350 82% 54%);
  }
  [data-theme="dark"]{
    --bg:  radial-gradient(1100px 700px at 10% 18%, rgba(40,60,100,.25), transparent 60%),
           radial-gradient(900px 700px at 85% 12%, rgba(120,60,140,.18), transparent 60%),
           linear-gradient(135deg, hsl(222 26% 12%), hsl(222 22% 16%));
    --ink: hsl(0 0% 96%);
    --muted: hsl(0 0% 78%);
    --glass: rgba(255,255,255,.08);
    --glass-b: rgba(255,255,255,.14);
    --border: rgba(255,255,255,.16);
    --accent: hsl(222 80% 66%);
    --accent-weak: hsl(222 85% 75%);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif, -apple-system, "SF Pro Text","SF Pro Display", Segoe UI, Roboto, Inter, system-ui;
    color: var(--ink);
    background: var(--bg);
    background-attachment: fixed;
  }
  a{color:inherit;text-decoration:none}
  main{max-width:1100px;margin:56px auto 80px;padding:0 18px}
  h1{font-size: clamp(26px, 3.5vw, 40px); margin: 14px 0}
  h2{font-size: clamp(20px, 2.6vw, 28px); margin: 14px 0; color:var(--muted)}
  .card, .flash, .stat, .panel{
    background: var(--glass);
    border: 1px solid var(--border);
    border-radius: 24px;
    backdrop-filter: blur(12px) saturate(130%);
    -webkit-backdrop-filter: blur(12px) saturate(130%);
    box-shadow: 0 20px 60px rgba(0,0,0,.12);
    padding: 22px;
  }
  .nav{position: sticky; top:0; z-index:20; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);}
  .nav-wrap{display:flex; align-items:center; gap:16px; max-width:1100px; margin: 8px auto; padding: 10px 18px; border-radius: 16px;}
  .brand{font-weight:800; letter-spacing:.3px}
  .tabs{position:relative; display:flex; gap:10px; padding:6px; border:1px solid var(--border); border-radius:999px; background: var(--glass); align-items:center}
  .indicator{position:absolute; top:50%; transform: translateY(-50%); left:6px; height:calc(100% - 12px); width:80px; border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.6)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.65), 0 6px 18px rgba(0,0,0,.12); transition: transform .60s cubic-bezier(.18,.9,.25,1); will-change: transform; }
  .tab{padding:10px 16px; border-radius:999px; position:relative; z-index:1; white-space:nowrap; color:var(--ink)}
  [data-theme="dark"] .indicator{background: rgba(255,255,255,.18); box-shadow: inset 0 0 0 1px rgba(255,255,255,.26), 0 6px 18px rgba(0,0,0,.35)}
  .seg{ position:relative; display:inline-flex; gap:0; height:36px; padding:2px; border:1px solid var(--border); border-radius:999px; background: var(--glass); }
  .seg-thumb{ position:absolute; top:50%; transform: translateY(-50%); left:2px; height:32px; width:32px; border-radius:999px; background: linear-gradient(180deg, rgba(255,255,255,.75), rgba(255,255,255,.6)); box-shadow: inset 0 0 0 1px rgba(255,255,255,.65), 0 6px 18px rgba(0,0,0,.12); transition: transform .60s cubic-bezier(.18,.9,.25,1); will-change: transform; }
  .seg button{ position:relative; z-index:1; height:32px; min-width:32px; padding:0 12px; display:inline-flex; align-items:center; justify-content:center; border:0; border-radius:999px; background:transparent; color:var(--ink); cursor:pointer }
  [data-theme="dark"] .seg-thumb{ background: rgba(255,255,255,.18); box-shadow: inset 0 0 0 1px rgba(255,255,255,.26), 0 6px 18px rgba(0,0,0,.35) }
  .btn{border:1px solid var(--border); border-radius:16px; padding:12px 16px; background: var(--glass-b); cursor:pointer}
  .row{display:flex; gap:12px; align-items:center; justify-content:center}
  :root{ --hit:44px }
  @media (max-width: 1024px){
    .nav .nav-wrap{ padding: max(10px, env(safe-area-inset-top)) 12px 10px 12px; }
    .tabs{ overflow:auto; -webkit-overflow-scrolling: touch; }
    .tab{ padding:10px 14px; }
    .card{ padding:20px; }
    main{ padding:16px }
    button{ min-height: var(--hit); }
  }
  @media (max-width: 640px){
    h1{ font-size: clamp(22px, 6vw, 28px) }
    .flash{ margin:32px auto; padding:28px 18px }
    .word{ font-size: clamp(32px, 10vw, 44px) }
    .row{ gap:8px }
    .row button{ padding:10px 12px; }
  }
  @media (hover: none){
    button:hover{ transform:none; box-shadow:none; }
  }
  @supports(padding: max(0px)){
    body{ padding-bottom: max(0px, env(safe-area-inset-bottom)); }
  }
  </style>
</head>

<body>
<div class="nav">
  <div class="nav-wrap">
    <div class="brand">GRE 词汇训练器</div>
    <div class="tabs" id="tabs">
      <div class="indicator" id="tabIndicator"></div>
      <a class="tab" href="./index.html">主页</a>
      <a class="tab" href="./study.html">学习</a>
      <a class="tab" href="./library.html">词库</a>
      <a class="tab" href="./settings.html">设置</a>
    </div>
    <div style="flex:1"></div>
    <div class="seg" id="themeSeg">
      <span class="seg-thumb" id="segThumb"></span>
      <button data-v="auto">A</button><button data-v="light">☀</button><button data-v="dark">☾</button>
    </div>
  </div>
</div>

<main>
<div class="card" style="margin-bottom:8px;background:rgba(255,230,150,.6);color:#553;"><b>Debug build (no Service Worker)</b> · v4.22.7 · ts=1754844031</div>
  <div class="card">
    <h1>词库</h1>
    <p style="color:var(--muted)">导入 CSV（列名至少包含 <code>word</code> 和 <code>cn</code> / <code>def</code> 之一）。</p>
    <input id="csv" type="file" accept=".csv" class="btn">
    <div id="msg" style="margin-top:12px; color:var(--muted)"></div>
  </div>

  <div class="panel" style="margin-top:16px">
    <div class="card"><div id="stats">暂无词库</div></div>
  </div>
</main>

<script>
// ===== Theme pill (isolated) =====
(function GRE_ThemePill(){
  const seg=document.getElementById('themeSeg'); if(!seg) return;
  const thumb=document.getElementById('segThumb');
  function resolve(v){ return v==='auto' ? (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light') : v; }
  function btnOf(v){ return [...seg.querySelectorAll('button[data-v]')].find(b=>b.dataset.v===v); }
  function place(btn, animate){
    thumb.style.width = btn.offsetWidth + 'px';
    const x = btn.offsetLeft;
    if(!animate){ thumb.style.transition='none'; } else { thumb.style.transition='transform .60s cubic-bezier(.18,.9,.25,1)'; }
    thumb.style.transform = 'translate('+x+'px, -50%)';
  }
  function apply(v, animate){
    const r=resolve(v);
    document.documentElement.setAttribute('data-theme', r);
    localStorage.setItem('gre_theme', v);
    const b = btnOf(v) || seg.querySelector('button[data-v]');
    place(b, animate);
  }
  const saved = localStorage.getItem('gre_theme') || 'auto';
  apply(saved, false);
  if(window.matchMedia){
    matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ()=>{
      if((localStorage.getItem('gre_theme')||'auto')==='auto') apply('auto', true);
    });
  }
  seg.addEventListener('click', e=>{
    const b=e.target.closest('button[data-v]'); if(!b) return;
    apply(b.dataset.v, true);
  });
  addEventListener('resize', ()=>{ const v=localStorage.getItem('gre_theme')||'auto'; const b=btnOf(v)||seg.querySelector('button[data-v]'); place(b,false); });
})();
</script>
<script>
// ===== Tabs indicator (isolated) =====
(function GRE_TabsIndicator(){
  const wrap=document.getElementById('tabs'); if(!wrap) return;
  const ind=document.getElementById('tabIndicator');
  const tabs=[...wrap.querySelectorAll('.tab')];
  function curTab(){
    const cur=(location.pathname.split('/').pop()||'index.html').toLowerCase();
    return tabs.find(t=>t.getAttribute('href').toLowerCase()===cur) || tabs[0];
  }
  function xy(el){
    const pr=wrap.getBoundingClientRect(); const er=el.getBoundingClientRect();
    const padL=parseFloat(getComputedStyle(wrap).paddingLeft)||6;
    return {x: Math.round(er.left-pr.left-padL), w: Math.round(er.width)};
  }
  function setPos(x,w,animate){
    ind.style.width=w+'px';
    if(!animate){ ind.style.transition='none'; } else { ind.style.transition='transform .60s cubic-bezier(.18,.9,.25,1)'; }
    ind.style.transform='translate('+x+'px, -50%)';
  }
  const cur=curTab(); const curXY=xy(cur);
  const prevX = parseFloat(sessionStorage.getItem('gre_tabs_prev_x')||'NaN');
  if(!Number.isNaN(prevX)){ setPos(prevX, curXY.w, false); requestAnimationFrame(()=> setPos(curXY.x, curXY.w, true)); }
  else { setPos(curXY.x, curXY.w, false); }
  tabs.forEach(t=> t.addEventListener('click', ()=>{ const p=xy(t); sessionStorage.setItem('gre_tabs_prev_x', String(p.x)); }));
  addEventListener('resize', ()=>{ const a=curTab(); const p=xy(a); setPos(p.x, p.w, false); });
})();
</script>
<script>
// ===== PWA register (with version bust) =====
<script>console.log('[GRE] noSW debug build loaded');</script>


<script>
// [GRE] ThemePill loaded
(function GRE_ThemePill(){
  const seg=document.getElementById('themeSeg'); if(!seg) return;
  const thumb=document.getElementById('segThumb');
  function resolve(v){ return v==='auto' ? (matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light') : v; }
  function btn(v){ return [...seg.querySelectorAll('button[data-v]')].find(b=>b.dataset.v===v); }
  function place(b,animate){ if(!b||!thumb) return; thumb.style.width=b.offsetWidth+'px'; thumb.style.transform='translate('+b.offsetLeft+'px, -50%)'; thumb.style.transition=animate?'transform .60s cubic-bezier(.18,.9,.25,1)':'none'; }
  function apply(v,animate){ const r=resolve(v); document.documentElement.setAttribute('data-theme', r); localStorage.setItem('gre_theme', v); place(btn(v)||seg.querySelector('button[data-v]'), animate); }
  const saved=localStorage.getItem('gre_theme')||'auto'; apply(saved,false);
  if(window.matchMedia){ matchMedia('(prefers-color-scheme: dark)').addEventListener('change', ()=>{ if((localStorage.getItem('gre_theme')||'auto')==='auto') apply('auto',true); }); }
  seg.addEventListener('click', e=>{ const b=e.target.closest('button[data-v]'); if(!b) return; apply(b.dataset.v,true); });
  addEventListener('resize', ()=>{ const v=localStorage.getItem('gre_theme')||'auto'; place(btn(v)||seg.querySelector('button[data-v]'), false); });
})();
</script>
<script>
// [GRE] TabsIndicator loaded
(function GRE_TabsIndicator(){
  const wrap=document.getElementById('tabs'); if(!wrap) return;
  const ind=document.getElementById('tabIndicator');
  const tabs=[...wrap.querySelectorAll('.tab')];
  function cur(){ const f=(location.pathname.split('/').pop()||'index.html').toLowerCase(); return tabs.find(t=>t.getAttribute('href').toLowerCase()===f) || tabs[0]; }
  function pos(el){ const pr=wrap.getBoundingClientRect(); const er=el.getBoundingClientRect(); const padL=parseFloat(getComputedStyle(wrap).paddingLeft)||6; return {x:Math.round(er.left-pr.left-padL), w:Math.round(er.width)}; }
  function set(x,w,anim){ ind.style.width=w+'px'; ind.style.transition=anim?'transform .60s cubic-bezier(.18,.9,.25,1)':'none'; ind.style.transform='translate('+x+'px, -50%)'; }
  const c=cur(); const p=pos(c); const prev=parseFloat(sessionStorage.getItem('gre_tabs_prev_x')||'NaN');
  if(!Number.isNaN(prev)){ set(prev,p.w,false); requestAnimationFrame(()=> set(p.x,p.w,true)); } else { set(p.x,p.w,false); }
  tabs.forEach(t=> t.addEventListener('click', ()=>{ const P=pos(t); sessionStorage.setItem('gre_tabs_prev_x', String(P.x)); }));
  addEventListener('resize', ()=>{ const p2=pos(cur()); set(p2.x,p2.w,false); });
})();
</script>

<script>
function parseCSV(text){
  const rows = text.split(/\r?\n/).filter(Boolean);
  if(!rows.length) return [];
  const header = rows.shift().split(',').map(h=>h.trim().toLowerCase());
  const map = h=>{
    if(/^(word|单词|词|英语|英文|拼写)$/.test(h)) return 'word';
    if(/^(cn|释义|中文|中文释义|意思|含义|义项)$/.test(h)) return 'cn';
    if(/^(def|definition|英文释义|英释|解释)$/.test(h)) return 'def';
    return h;
  };
  const H=header.map(map);
  return rows.map(line=>{
    const cols=line.split(',');
    const obj={};
    H.forEach((h,i)=> obj[h]=(cols[i]||'').trim());
    return { word: obj.word||'', cn: obj.cn||'', def: obj.def||'' };
  }).filter(x=>x.word);
}
</script>

</body></html>